<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø¯Ù…Ù† TKTK - Ø§Ù„Ù…Ø·ÙˆØ±</title>
    <style>
        body { font-family: sans-serif; background: #111; color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: #222; padding: 20px; border-radius: 10px; width: 90%; max-width: 450px; text-align: center; border: 1px solid #333; }
        
        /* Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        .tabs { display: flex; justify-content: space-around; margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 10px; }
        .tab-btn { background: none; border: none; color: #888; font-size: 16px; cursor: pointer; padding: 5px 15px; }
        .tab-btn.active { color: #E91E63; border-bottom: 2px solid #E91E63; font-weight: bold; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        input, button { width: 100%; padding: 12px; margin-top: 10px; border-radius: 8px; border: none; box-sizing: border-box; background: #333; color: white; outline: none; }
        input:focus { border: 1px solid #E91E63; }
        button.upload-btn { background: #E91E63; font-weight: bold; margin-top: 20px; cursor: pointer; }
        button.upload-btn:hover { background: #C2185B; }
        
        .delete-item { display: flex; justify-content: space-between; align-items: center; background: #1a1a1a; padding: 10px; margin-bottom: 5px; border-radius: 5px; text-align: right; }
        .delete-btn { background: #ff4444; width: auto; padding: 5px 15px; margin: 0; font-size: 12px; cursor: pointer; }
        
        .status { margin-top: 15px; font-size: 0.9em; }
        .preview-img { width: 40px; height: 40px; border-radius: 5px; object-fit: cover; margin-left: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('upload')">ğŸ“¤ Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ</button>
        <button class="tab-btn" onclick="switchTab('manage')">ğŸ—‘ï¸ Ø¥Ø¯Ø§Ø±Ø© ÙˆØ­Ø°Ù</button>
    </div>

    <div id="upload" class="tab-content active">
        <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</h3>
        <input type="text" id="vidTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (Ù…Ø«Ø§Ù„: ØªØµÙ…ÙŠÙ… Ø¬Ø¯ÙŠØ¯ ğŸ”¥)">
        <div style="display:flex; gap:5px;">
            <input type="number" id="vidLikes" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§ÙŠÙƒØ§Øª â¤ï¸">
            <input type="number" id="vidSaves" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø­ÙØ¸ ğŸ’¾">
        </div>
        <div style="display:flex; gap:5px;">
            <input type="number" id="vidShares" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ğŸ”—">
            <input type="number" id="vidViews" placeholder="Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª (Ù…ÙŠØ²Ø© 1) ğŸ‘ï¸">
        </div>
        
        <input type="file" id="fileInput" accept="video/*" style="margin-top:15px; background:#444;">
        <button class="upload-btn" onclick="uploadAndSave()">Ø±ÙØ¹ ÙˆÙ†Ø´Ø± ğŸš€</button>
        <div id="status" class="status"></div>
    </div>

    <div id="manage" class="tab-content">
        <h3>Ø­Ø°Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</h3>
        <div id="videoList" style="max-height: 400px; overflow-y: auto;">
            Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp, getDocs, deleteDoc, doc, orderBy, query } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyC59tNY6IlcGI7XSd1-yDTcN1Iux5zv7k8",
        authDomain: "tktk-4f724.firebaseapp.com",
        projectId: "tktk-4f724",
        storageBucket: "tktk-4f724.firebasestorage.app",
        messagingSenderId: "349884221151",
        appId: "1:349884221151:web:68d68a27b7fef09ad40b6a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø±ÙØ¹
    window.uploadAndSave = async function() {
        const fileInput = document.getElementById('fileInput');
        const statusDiv = document.getElementById('status');
        const title = document.getElementById('vidTitle').value;
        const likes = document.getElementById('vidLikes').value || "0";
        const saves = document.getElementById('vidSaves').value || "0";
        const shares = document.getElementById('vidShares').value || "0";
        const views = document.getElementById('vidViews').value || "0";

        if (!fileInput.files[0]) return alert("Ø§Ø®ØªØ± ÙÙŠØ¯ÙŠÙˆ Ø£ÙˆÙ„Ø§Ù‹!");

        statusDiv.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹ Ù„Ù€ Catbox...";
        
        const formData = new FormData();
        formData.append('reqtype', 'fileupload');
        formData.append('fileToUpload', fileInput.files[0]);

        try {
            const res = await fetch('https://corsproxy.io/?' + encodeURIComponent('https://catbox.moe/user/api.php'), { method: 'POST', body: formData });
            const videoUrl = await res.text();

            if (!videoUrl.startsWith('http')) throw new Error('ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹');

            statusDiv.innerText = "ğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©...";
            
            await addDoc(collection(db, "videos"), {
                url: videoUrl,
                title: title,
                stats: { likes, saves, shares, views },
                timestamp: serverTimestamp()
            });

            statusDiv.innerHTML = `<span style="color:#4CAF50">âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø±!</span>`;
            loadVideosForDelete(); // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø°Ù

        } catch (err) {
            console.error(err);
            statusDiv.innerText = "âŒ Ø®Ø·Ø£: " + err.message;
        }
    };

    // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù„Ù„Ø­Ø°Ù
    async function loadVideosForDelete() {
        const listDiv = document.getElementById('videoList');
        listDiv.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...";
        
        const q = query(collection(db, "videos"), orderBy("timestamp", "desc"));
        const snapshot = await getDocs(q);
        
        listDiv.innerHTML = "";
        snapshot.forEach(docSnap => {
            const data = docSnap.data();
            const item = document.createElement('div');
            item.className = 'delete-item';
            item.innerHTML = `
                <div style="display:flex; align-items:center;">
                    <video src="${data.url}" class="preview-img"></video>
                    <span style="margin-right:10px; font-size:12px;">${data.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</span>
                </div>
                <button class="delete-btn" onclick="deleteVideo('${docSnap.id}')">Ø­Ø°Ù</button>
            `;
            listDiv.appendChild(item);
        });
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù Ø§Ù„ÙØ¹Ù„ÙŠØ©
    window.deleteVideo = async (id) => {
        if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŸ')) {
            await deleteDoc(doc(db, "videos", id));
            loadVideosForDelete();
        }
    };

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    window.switchTab = (tabId) => {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.target.classList.add('active');
        if(tabId === 'manage') loadVideosForDelete();
    }
</script>

</body>
</html>
