<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø¯Ù…Ù† TKTK - Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ</title>
    <style>
        body { font-family: sans-serif; background: #111; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background: #222; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px; text-align: center; }
        input, button { width: 100%; padding: 10px; margin-top: 10px; border-radius: 5px; border: none; }
        button { background: #E91E63; color: white; cursor: pointer; font-weight: bold; }
        button:hover { background: #C2185B; }
        .status { margin-top: 15px; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ¥ Ù„ÙˆØ­Ø© Ø§Ù„Ø±ÙØ¹ (Firestore)</h2>
    <input type="file" id="fileInput" accept="video/*">
    <button onclick="uploadAndSave()">Ø±ÙØ¹ ÙˆÙ†Ø´Ø± ğŸš€</button>
    <div id="status" class="status"></div>
</div>

<script type="module">
    // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ÙƒØªØ¨Ø§Øª Firebase (Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø­Ø¯ÙŠØ« 12.8.0)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

    // ğŸ”‘ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø®Ø§ØµØ©
    const firebaseConfig = {
        apiKey: "AIzaSyC59tNY6IlcGI7XSd1-yDTcN1Iux5zv7k8",
        authDomain: "tktk-4f724.firebaseapp.com",
        projectId: "tktk-4f724",
        storageBucket: "tktk-4f724.firebasestorage.app",
        messagingSenderId: "349884221151",
        appId: "1:349884221151:web:68d68a27b7fef09ad40b6a"
    };

    // ØªØ´ØºÙŠÙ„ Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.uploadAndSave = async function() {
        const fileInput = document.getElementById('fileInput');
        const statusDiv = document.getElementById('status');

        if (!fileInput.files[0]) return alert("Ø§Ø®ØªØ± ÙÙŠØ¯ÙŠÙˆ Ø£ÙˆÙ„Ø§Ù‹!");

        statusDiv.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹ Ù„Ù„Ø³ÙŠØ±ÙØ± (Catbox)...";
        
        const formData = new FormData();
        formData.append('reqtype', 'fileupload');
        formData.append('fileToUpload', fileInput.files[0]);

        try {
            // 1. Ø§Ù„Ø±ÙØ¹ Ù„Ù€ Catbox
            // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù†Ø³ØªØ®Ø¯Ù… corsproxy Ù„ØªÙØ§Ø¯ÙŠ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø­Ù…Ø§ÙŠØ©
            const res = await fetch('https://corsproxy.io/?' + encodeURIComponent('https://catbox.moe/user/api.php'), {
                method: 'POST',
                body: formData
            });
            const videoUrl = await res.text();

            if (!videoUrl.startsWith('http')) throw new Error('ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹ Ù„Ù€ Catbox');

            // 2. Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø¬ÙˆØ¬Ù„ (Firestore)
            statusDiv.innerText = "ğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
            
            await addDoc(collection(db, "videos"), {
                url: videoUrl,
                timestamp: serverTimestamp()
            });

            statusDiv.innerHTML = `<span style="color:#4CAF50">âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!</span><br><small>Ø§Ù„Ø±Ø§Ø¨Ø·: ${videoUrl}</small>`;

        } catch (err) {
            console.error(err);
            statusDiv.innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + err.message;
        }
    };
</script>

</body>
</html>
