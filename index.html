<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TKTK Video Feed</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; color: #fff; font-family: sans-serif; overflow: hidden; }

        #feed-container {
            height: 100vh;
            width: 100vw;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
        }

        .video-card {
            height: 100vh;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            scroll-snap-align: start;
            position: relative;
            background: #111;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            max-width: 500px;
        }

        .overlay {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 2;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
            pointer-events: none;
        }
    </style>
</head>
<body>

<div id="feed-container">
    <div style="height:100vh; display:flex; justify-content:center; align-items:center;">
        Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª... ğŸš€
    </div>
</div>

<script type="module">
    // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ÙƒØªØ¨Ø§Øª Firebase (Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø­Ø¯ÙŠØ« 12.8.0)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import { getFirestore, collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

    // ğŸ”‘ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø®Ø§ØµØ©
    const firebaseConfig = {
        apiKey: "AIzaSyC59tNY6IlcGI7XSd1-yDTcN1Iux5zv7k8",
        authDomain: "tktk-4f724.firebaseapp.com",
        projectId: "tktk-4f724",
        storageBucket: "tktk-4f724.firebasestorage.app",
        messagingSenderId: "349884221151",
        appId: "1:349884221151:web:68d68a27b7fef09ad40b6a"
    };

    // ØªØ´ØºÙŠÙ„ Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const feedContainer = document.getElementById('feed-container');

    // Ø·Ù„Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…Ø±ØªØ¨Ø© Ø¨Ø§Ù„Ø£Ø­Ø¯Ø«
    const q = query(collection(db, "videos"), orderBy("timestamp", "desc"));

    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    onSnapshot(q, (snapshot) => {
        feedContainer.innerHTML = ""; 

        if (!snapshot.empty) {
            snapshot.forEach((doc) => {
                const videoData = doc.data();
                if(videoData.url) {
                    const card = document.createElement('div');
                    card.className = 'video-card';
                    card.innerHTML = `
                        <video src="${videoData.url}" loop playsinline onclick="togglePlay(this)"></video>
                        <div class="overlay">
                            <h3>ğŸ”¥ Ø¬Ø¯ÙŠØ¯</h3>
                        </div>
                    `;
                    feedContainer.appendChild(card);
                }
            });
            // ØªÙØ¹ÙŠÙ„ Ù…ÙŠØ²Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            setupScrollObserver();
        } else {
            feedContainer.innerHTML = "<h3 style='text-align:center; padding-top:50px; color:#aaa'>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</h3>";
        }
    }, (error) => {
        console.error("Error getting documents: ", error);
        // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¥Ø°Ø§ Ø¸Ù‡Ø± Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„ ÙŠØ·Ù„Ø¨ "Create Index"ØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø®Ø·Ø£
    });

    // ÙƒÙˆØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ±
    function setupScrollObserver() {
        const videos = document.querySelectorAll('video');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.play();
                } else {
                    entry.target.pause();
                    entry.target.currentTime = 0;
                }
            });
        }, { threshold: 0.6 });

        videos.forEach(video => observer.observe(video));
    }

    window.togglePlay = (video) => {
        if (video.paused) video.play();
        else video.pause();
    };
</script>

</body>
</html>
